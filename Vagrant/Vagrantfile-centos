VAGRANTFILE_API_VERSION = "2"

$k8s_count=3

$k8s_memory=3192
$k8s_cpus=2

def workerIP(num)
  return "10.10.10.#{num+10}"
end

Vagrant.configure(VAGRANTFILE_API_VERSION) do |config|
  config.ssh.insert_key = false

config.vm.box = "basdemirs/centos7-kubeadm"
  (1..$k8s_count).each do |i|
    vmName = "def"
    if i == 1
      vmName = "router192-10-Net"
    elsif i == 2
      vmName = "client-10-Net"
    else
      vmName = "client-192-Net"
    end
  config.vm.define vm_name = vmName do |node|
    if i == 1
      node.vm.network :private_network, :ip => "192.168.0.100" 
      node.vm.network :private_network, :ip => "#{workerIP(i)}"
    elsif i == 2
      node.vm.network :private_network, :ip => "#{workerIP(i)}"
    else
      node.vm.network :private_network, :ip => "192.168.0.101"
    end
    node.vm.hostname = vmName
    node.vm.provider "virtualbox" do |v|
      v.memory = $k8s_memory
      v.cpus = $k8s_cpus
    end
  end
end
  config.vm.provision "shell", inline: <<-SHELL
# disable if you like    yum update -y
# disable if you like   yum install locate bridge-utils vim git nfs-utils -y
    systemctl stop firewalld.service
    systemctl disable firewalld.service
    systemctl start docker
    systemctl enable docker
    usermod -aG docker vagrant
    updatedb
  SHELL

end
